<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SWH React Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #0b0f1f; color: #e9ecf6; }
    header { padding: 16px 24px; background: linear-gradient(135deg, #0f214a, #102a54); }
    h1 { margin: 0; font-size: 20px; }
    .container { padding: 16px 24px; display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .card { background: #121b33; border: 1px solid #1f2a44; border-radius: 12px; padding: 16px; }
    label { display: block; margin-bottom: 6px; }
    input { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #1f2a44; background: #0e152b; color: #e9ecf6; }
    button { padding: 10px 14px; background: #1f7ae0; color: white; border: none; border-radius: 8px; cursor: pointer; }
    .nudge { padding: 8px; border-radius: 8px; background: #162548; margin-bottom: 8px; }
  </style>
</head>
<body>
  <header><h1>Smart Warranty Hub Dashboard (React)</h1></header>
  <div class="container">
    <div class="card">
      <label>User ID</label><input id="userId" value="user-1" />
      <label>Warranty ID</label><input id="warrantyId" placeholder="wty_xxx" />
      <button onclick="loadData()">Load</button>
      <div id="status"></div>
    </div>
    <div class="card">
      <h3>Warranty</h3>
      <div id="warranty"></div>
    </div>
    <div class="card">
      <h3>Summary</h3>
      <div id="summary"></div>
    </div>
    <div class="card">
      <h3>Advisories</h3>
      <div id="advisories"></div>
    </div>
    <div class="card">
      <h3>Scores</h3>
      <canvas id="scoresChart"></canvas>
    </div>
  </div>
  <script>
    async function loadData() {
      const userId = document.getElementById('userId').value;
      const warrantyId = document.getElementById('warrantyId').value;
      const statusEl = document.getElementById('status');
      statusEl.textContent = 'Loading...';
      try {
        const headers = {};
        const w = await fetch(`/warranties/${warrantyId}`, { headers }).then(r => r.json());
        document.getElementById('warranty').textContent = JSON.stringify(w, null, 2);
        const summary = await fetch('/warranties/summary', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({warranty_id: warrantyId}) }).then(r=>r.json());
        document.getElementById('summary').textContent = summary.summary || '';
        const adv = await fetch(`/advisories/${warrantyId}?user_id=${userId}`, { headers }).then(r=>r.json());
        document.getElementById('advisories').innerHTML = adv.nudges.map(n=>`<div class="nudge"><strong>${n.title}</strong><div>${n.message}</div></div>`).join('');
        const pred = await fetch('/predictive/score', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({user_id:userId,warranty_id:warrantyId}) }).then(r=>r.json());
        renderChart(w, pred);
        statusEl.textContent = 'Loaded';
      } catch(err) {
        statusEl.textContent = 'Error: ' + err;
      }
    }
    let chart;
    function renderChart(w, pred) {
      const ctx = document.getElementById('scoresChart').getContext('2d');
      const data = {
        labels: ['Predictive'],
        datasets: [{
          label: 'Score',
          data: [pred.score || 0],
          backgroundColor: '#1f7ae0'
        }]
      };
      if (chart) chart.destroy();
      chart = new Chart(ctx, { type:'bar', data, options:{ scales:{ y:{ min:0, max:1 }}}});
    }
  </script>
</body>
</html>
